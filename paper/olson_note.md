# AprilTag: 一个健壮而灵活的视觉基准系统

> 使用自然出现的特征一直是机器感知的重点，但人造特征在一些实验中也扮演了很重要的角色，可以简化一些并不关注自然特征的系统。论文设计了一种使用二维码的视觉基准系统，可以从单张图像中实现六个自由度上的定位。这一系统融合了之前的直线检测、数字编码技术，对遮挡、扭曲、镜头失真有更好的效果。虽然在概念上类似于ARTag系统，但这一方法是完全开源的，算法也有详细的文档。

## Introduction

虽然和QR码很像，但视觉基准码有完全不同的目标和应用。使用QR码时，通常需要将摄像头与标签对齐，然后以相当高的分辨率拍摄它，获得数百个字节，比如一个网址。相比之下，视觉基准码只承载很小的信息（也许是12位），但即使它的分辨率非常低、光线不均匀、旋转异常或隐藏在图像的角落里，也能被自动检测和定位。为了便于检测，视觉基准码包含更少的信息。

视觉基准系统最著名的应用可能是在增强现实中，这刺激了几个流行系统的发展，包括ARToolkit和ARTag。现实世界的物体可以用视觉基准系统定位，叠加上虚拟生成的图像。同样，视觉基准还可用于基本动作捕捉。

设计一个优秀的视觉基准系统的难点来自于两方面：视觉检测以及信息编码。

下文分三个部分介绍AprilTag：标签检测器、编码系统、评估对比。

## Detector

检测器的主要功能就是在图片中寻找可能存在的标签，或者说“内部颜色深的方形”。

检测器设计为很低的假阴率，所以就有一个很高的假阳率。（真假表示识别正确与否，阴阳表示识别的结果是真或假）编码系统会补偿这一过高的假阳率。

### 直线检测

我们的方法从检测图像中的线开始。我们的方法与ARTag检测器的基本方法相似，计算每个像素点的梯度方向和梯度大小，并将像素点聚类成梯度方向和梯度大小相似的分量。

该聚类算法类似于Felzenszwalb的基于图的方法：创建一个图，每个节点代表一个像素。在相邻像素之间添加边，边权等于像素在梯度方向上的差值。然后将这些边按边权递增的方式进行排序处理：对于每条边，我们测试其两侧像素所属的集群是否应该连接在一起。假设一个集群n，我们把其中像素梯度方向的范围记为D(n)，梯度大小的范围记为M(n)。也就是说，D(n)和M(n)是标量值，分别表示梯度方向和梯度大小的最大值和最小值之差。对于D()，必须小心处理2π周期。然而，由于有用的边的跨度要比π小得多，这就很简单了。

给定n和m两个集群，如果满足以下两个条件，我们将它们连接在一起:

$$D(n \cup m) \leq \min (D(n), D(m))+K_{D} /|n \cup m|$$

$$M(n \cup m) \leq \min (M(n), M(m))+K_{M} /|n \cup m|$$

条件由[19]改编而来，可以直观理解:D()和M()值小，表示分量内部变化小。如果两个集群的联合和单独使用的集群一样一致，则将它们连接在一起。K<sub>D</sub>、K<sub>M</sub>参数允许分量内变化的适度增加，但随着分量变大，这种变化会迅速缩小。在早期的迭代中，K参数本质上允许每个集群“学习”其簇内的变化。在我们的实验中，我们使用了K<sub>D</sub>=100和K<sub>M</sub>=1200，尽管该算法在广泛的值范围内都工作得很好。

（？）由于性能原因，边缘权值被量化并存储为定点数。这允许边缘使用线性时间计数排序[20]。使用unionfind算法[20]可以有效地进行实际的合并操作，并将梯度方向和幅度的上界和下界存储在一个简单的数组中，该数组由每个分量的代表成员索引。

这种基于梯度的聚类方法对图像中的噪声很敏感，即使是少量的噪声也会引起局部梯度方向的变化，抑制了成分的增长。解决这个问题的方法是对图像进行低通滤波。与其他问题域不同，这种过滤可以模糊图像中的有用信息，标签的边缘本质上是大规模的特征（特别是与数据字段相比），因此这种过滤不会导致信息丢失。我们推荐σ=0.8。

（？）聚类操作完成后，使用传统的最小二乘方法将线段附加到互相连接的组件上，加权每个点的梯度大小（见图3）。我们调整每个线段，使其阴暗面在左，亮面在右。在处理的下一个阶段中，这允许我们在每个四轴上执行一个缠绕规则。

分割算法是我们的检测方案中最慢的阶段。作为一种解决方案，这个分割可以用图像的一半分辨率执行，以提高速度。子采样操作可以与推荐的低通滤波器有效地结合。这种优化的结果是适度减少检测范围，因为非常小的矩形可能不再被检测。

### 矩形检测

此时，已经为图像计算了一组有向线段。下一个任务是找到一系列的线段，形成一个矩形，同时对于遮挡和噪声尽可能健壮。